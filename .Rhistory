knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
knitr::opts_knit$set(root.dir = "C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Repositorios/Repositorio/Taller4-DifinDif")
#install.packages("haven")
#install.packages("plm")
#install.packages("skimr")
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("modelsummary")
#install.packages("knitr")
#install.packages("tinytex")
#tinytex::install_tinytex()
#install.packages("survey")
library(knitr)
library(haven)
library(plm)
library(plm)
library(scales)
library(skimr)
library(ggplot2)
library(AER)
library(AER)
library(fixest)
library(sandwich)
library(tidyverse)
library(tidyverse)
library(stargazer)
library(survey)
getwd()
# Leer archivo .dta
data <- read_dta("SoapOperas2.dta")
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
knitr::opts_knit$set(root.dir = "C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Repositorios/Repositorio/Taller4-DifinDif")
# Leer archivo .dta
data <- read_dta("SoapOperas2.dta")
n <- nrow(data)
#Seleccionar el 5% al azar
elim <- sample(1:n, size = round(0.05 * n))
#Redefinir la base sin lo seleccionado
data_trim <- data[-elim, ]
#Verificar dimensiones
dim(data)
#Verificar dimensiones
dim(data_trim)
#Restringir la nueva base al percentil 95
p95 <- quantile(data_trim$geoarea80, probs = 0.95, na.rm = TRUE)
data_trim <- subset(data_trim, geoarea80 <= p95)
summary(data_sub$geoarea80)
summary(data_trim$geoarea80)
# Leer archivo .dta
data <- read_dta("SoapOperas2.dta")
#Establecemos la semilla de replicabilidad
set.seed(201613424)
n <- nrow(data)
#Seleccionar el 5% al azar
elim <- sample(1:n, size = round(0.05 * n))
#Redefinir la base sin lo seleccionado
data_trim <- data[-elim, ]
#Restringir la nueva base al percentil 95
p95 <- quantile(data_trim$geoarea80, probs = 0.95, na.rm = TRUE)
print(summary(data_trim$geoarea80))
data_sub <- subset(data_trim, geoarea80 <= p95)
print(summary(data_sub$geoarea80))
print(p95)
data_final <- subset(data_trim, geoarea80 <= p95)
rm(data_sub)
View(data_final)
View(data)
# Modelo 1: sin controles, sin efectos fijos de área, solo efectos fijos de tiempo
m1 <- feols(B ~ globocoverage1 | year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
# Modelo 2: sin controles, con efectos fijos de área y tiempo
m2 <- feols(B ~ globocoverage1 | amc_code + year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
# Modelo 3: con controles + efectos fijos de área y tiempo
m3 <- feols(B ~ globocoverage1 + age + agesq + yrs_edu + yrsedu_head + wealth_noTV + catholic + rural + Doctors + ipc_renta + stock + stocksq | amc_code + year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
# Resumen de resultados
stargazer(
m1, m2, m3,
type = "text",
se = list(se_m1, se_m2, se_m3),
dep.var.labels = "Prob. de dar a luz",
covariate.labels =  c("Cobertura Globo",
"Edad",
"Edad al cuadrado",
"Años de educación (mujer)",
"Años de educación (jefe de hogar)",
"Riqueza (sin TV)",
"Católica",
"Rural",
"Doctores per cápita",
"Ingreso per cápita",
"Stock de TV",
"Stock de TV al cuadrado"),
omit = "factor\\(year\\)|factor\\(area\\)",
omit.labels = "Efectos fijos",
star.cutoffs = c(0.1, 0.05, 0.01),
digits = 3,
title = "Impacto de la llegada de Globo sobre la fertilidad",
notes = "Errores estándar clusterizados a nivel de área"
)
# Resumen de resultados
stargazer(
m1, m2, m3,
type = "text",
dep.var.labels = "Prob. de dar a luz",
covariate.labels =  c("Cobertura Globo",
"Edad",
"Edad al cuadrado",
"Años de educación (mujer)",
"Años de educación (jefe de hogar)",
"Riqueza (sin TV)",
"Católica",
"Rural",
"Doctores per cápita",
"Ingreso per cápita",
"Stock de TV",
"Stock de TV al cuadrado"),
omit = "factor\\(year\\)|factor\\(area\\)",
omit.labels = "Efectos fijos",
star.cutoffs = c(0.1, 0.05, 0.01),
digits = 3,
title = "Impacto de la llegada de Globo sobre la fertilidad",
notes = "Errores estándar clusterizados a nivel de área"
)
coefs <- list(coef(m1), coef(m2), coef(m3))
ses   <- list(se(m1, cluster = ~amc_code),
se(m2, cluster = ~amc_code),
se(m3, cluster = ~amc_code))
# Resumen de resultados
stargazer(
m1, m2, m3,
type = "text",
coef = coefs,
se   = ses,
dep.var.labels = "Prob. de dar a luz",
covariate.labels =  c("Cobertura Globo",
"Edad",
"Edad al cuadrado",
"Años de educación (mujer)",
"Años de educación (jefe de hogar)",
"Riqueza (sin TV)",
"Católica",
"Rural",
"Doctores per cápita",
"Ingreso per cápita",
"Stock de TV",
"Stock de TV al cuadrado"),
omit = "factor\\(year\\)|factor\\(area\\)",
omit.labels = "Efectos fijos",
star.cutoffs = c(0.1, 0.05, 0.01),
digits = 3,
title = "Impacto de la llegada de Globo sobre la fertilidad",
notes = "Errores estándar clusterizados a nivel de área"
)
# Resumen de resultados
stargazer(
m1, m2, m3,
type = "text",
coef = coefs,
se  = ses,
dep.var.labels = "Prob. de dar a luz",
covariate.labels =  c("Cobertura Globo",
"Edad",
"Edad al cuadrado",
"Años de educación (mujer)",
"Años de educación (jefe de hogar)",
"Riqueza (sin TV)",
"Católica",
"Rural",
"Doctores per cápita",
"Ingreso per cápita",
"Stock de TV",
"Stock de TV al cuadrado"),
omit = "factor\\(year\\)|factor\\(area\\)",
omit.labels = "Efectos fijos",
star.cutoffs = c(0.1, 0.05, 0.01),
digits = 3,
title = "Impacto de la llegada de Globo sobre la fertilidad",
notes = "Errores estándar clusterizados a nivel de área"
)
etable(
m1, m2, m3,
se = "cluster",            # usa la clusterización guardada en cada modelo
dict = c(
"globocoverage1" = "Cobertura Globo",
"age"            = "Edad",
"agesq"          = "Edad al cuadrado",
"yrs_edu"        = "Años de educación (mujer)",
"yrsedu_head"    = "Años de educación (jefe de hogar)",
"wealth_noTV"    = "Riqueza (sin TV)",
"catholic"       = "Católica",
"rural"          = "Rural",
"Doctors"        = "Doctores per cápita",
"ipc_renta"      = "Ingreso per cápita (IPC renta)",
"stock"          = "Stock de TV",
"stocksq"        = "Stock de TV al cuadrado"
),
title = "Impacto de la cobertura de Globo sobre la fertilidad",
fitstat = ~ n + r2
)
etable(
m1, m2, m3,
se = "cluster",            # usa la clusterización guardada en cada modelo
dict = c(
"globocoverage1" = "Cobertura Globo",
"age"            = "Edad",
"agesq"          = "Edad al cuadrado",
"yrs_edu"        = "Años de educación (mujer)",
"yrsedu_head"    = "Años de educación (jefe de hogar)",
"wealth_noTV"    = "Riqueza (sin TV)",
"catholic"       = "Católica",
"rural"          = "Rural",
"Doctors"        = "Doctores per cápita",
"ipc_renta"      = "Ingreso per cápita (IPC renta)",
"stock"          = "Stock de TV",
"stocksq"        = "Stock de TV al cuadrado"
),
title = "Impacto de la cobertura de Globo sobre la fertilidad",
fitstat = ~ n + r2,
tex = TRUE
)
# Cargar liberias y paquetes
#install.packages("haven")
#install.packages("plm")
#install.packages("skimr")
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("modelsummary")
#install.packages("knitr")
#install.packages("tinytex")
#tinytex::install_tinytex()
#install.packages("survey")
library(knitr)
library(haven)
library(plm)
library(scales)
library(skimr)
library(dplyr)
library(ggplot2)
library(AER)
library(fixest)
library(lmtest)
library(sandwich)
library(tidyverse)
library(stargazer)
library(survey)
# Leer archivo .dta
data <- read_dta("SoapOperas2.dta")
#Establecemos la semilla de replicabilidad
set.seed(201613424)
n <- nrow(data)
#Seleccionar el 5% al azar
elim <- sample(1:n, size = round(0.05 * n))
#Redefinir la base sin lo seleccionado
data_trim <- data[-elim, ]
#Restringir la nueva base al percentil 95
p95 <- quantile(data_trim$geoarea80, probs = 0.95, na.rm = TRUE)
data_final <- subset(data_trim, geoarea80 <= p95)
# Modelo 1: sin controles, sin efectos fijos de área, solo efectos fijos de tiempo
m1 <- feols(B ~ globocoverage1 | year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
# Modelo 2: sin controles, con efectos fijos de área y tiempo
m2 <- feols(B ~ globocoverage1 | amc_code + year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
# Modelo 3: con controles + efectos fijos de área y tiempo
m3 <- feols(B ~ globocoverage1 + age + agesq + yrs_edu + yrsedu_head + wealth_noTV + catholic + rural + Doctors + ipc_renta + stock + stocksq | amc_code + year,
data = data_final,
weights = ~weight,
cluster = ~amc_code)
coefs <- list(coef(m1), coef(m2), coef(m3))
ses   <- list(se(m1, cluster = ~amc_code),
se(m2, cluster = ~amc_code),
se(m3, cluster = ~amc_code))
# Resumen de resultados
etable(
m1, m2, m3,
se = "cluster",            # usa la clusterización guardada en cada modelo
dict = c(
"globocoverage1" = "Cobertura Globo",
"age"            = "Edad",
"agesq"          = "Edad al cuadrado",
"yrs_edu"        = "Años de educación (mujer)",
"yrsedu_head"    = "Años de educación (jefe de hogar)",
"wealth_noTV"    = "Riqueza (sin TV)",
"catholic"       = "Católica",
"rural"          = "Rural",
"Doctors"        = "Doctores per cápita",
"ipc_renta"      = "Ingreso per cápita (IPC renta)",
"stock"          = "Stock de TV",
"stocksq"        = "Stock de TV al cuadrado"
),
title = "Impacto de la cobertura de Globo sobre la fertilidad",
fitstat = ~ n + r2,
tex = TRUE
)
